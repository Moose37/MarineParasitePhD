library(taxize)
library(worrms)
library(tidyverse)

just_worms_records <- function(x,y) {
  #Pull worms species names
  worms <- do.call(rbind, downstream(x, db = 'worms', downto = 'species', rank = y)) #pulls worms species names out
  
  
  #Finally call the full worms record out
  i <- do.call(rbind, lapply(worms$id, function(i){
    wm_record(i)
  }))
  
  #save in file
  write_csv(i, file = paste("C:/Users/Mooseface/Google Drive/University/PhD NZ/Data_and_code/Animalia sets/nematoda_",x,".csv", sep=""))
  
}

Nematoda <- just_worms_records('Nematoda', 'Nematoda')

#Children of Phylum Nematoda

#Let's bring it together into one chordata
Chordata <- as_tibble(list.files('C:/Users/mooseface/Google Drive/University/PhD NZ/Data_and_code/Animalia sets',
                       pattern = "chordata_", full.names = TRUE))
            
Chordata <- bind_rows(apply(Chordata, 1, read_csv)) 

write.csv(Chordata, 'C:/Users/mooseface/Google Drive/University/PhD NZ/Data_and_code/Animalia sets/Chordata.csv')


